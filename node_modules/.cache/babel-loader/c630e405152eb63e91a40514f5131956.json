{"ast":null,"code":"import _slicedToArray from\"C:/Users/86136/Desktop/\\u5B66\\u4E60\\u8FDB\\u5EA6/new_html/fullstack_yyf/react/cloud-music/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"C:/Users/86136/Desktop/\\u5B66\\u4E60\\u8FDB\\u5EA6/new_html/fullstack_yyf/react/cloud-music/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import React,{forwardRef,useState,useEffect,useRef,useImperativeHandle,useMemo}from\"react\";import BScroll from\"better-scroll\";import styled from'styled-components';import Loading from'../loading';import{debounce}from\"../../api/utils\";import LoadingV2 from'../loading-v2';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ScrollContainer=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100%;\\n  overflow: hidden;\\n\"])));var PullUpLoading=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  left:0; right:0;\\n  bottom: 5px;\\n  width: 60px;\\n  height: 60px;\\n  margin: auto;\\n  z-index: 100;\\n\"])));export var PullDownLoading=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  left:0; right:0;\\n  top: 0px;\\n  height: 30px;\\n  margin: auto;\\n  z-index: 100;\\n\"])));var Scroll=/*#__PURE__*/forwardRef(function(props,ref){var _useState=useState(),_useState2=_slicedToArray(_useState,2),bScroll=_useState2[0],setBScroll=_useState2[1];var scrollContaninerRef=useRef();var direction=props.direction,click=props.click,refresh=props.refresh,bounceTop=props.bounceTop,bounceBottom=props.bounceBottom;var pullUp=props.pullUp,pullDown=props.pullDown,onScroll=props.onScroll,pullUpLoading=props.pullUpLoading,pullDownLoading=props.pullDownLoading;var pullUpDebounce=useMemo(function(){return debounce(pullUp,300);},[pullUp]);var pullDownDebounce=useMemo(function(){return debounce(pullDown,300);},[pullDown]);useEffect(function(){var scroll=new BScroll(scrollContaninerRef.current,{scrollX:direction===\"horizontal\",scrollY:direction===\"vertical\",probeType:3,click:click,bounce:{top:bounceTop,bottom:bounceBottom}});setBScroll(scroll);return function(){setBScroll(null);};// eslint-disable-next-line\n},[]);useEffect(function(){if(!bScroll||!onScroll)return;bScroll.on('scroll',function(scroll){onScroll(scroll);});return function(){bScroll.off('scroll');};},[onScroll,bScroll]);useEffect(function(){if(!bScroll||!pullUp)return;bScroll.on('scrollEnd',function(){//判断是否滑动到了底部\nif(bScroll.y<=bScroll.maxScrollY+100){pullUpDebounce();}});return function(){bScroll.off('scrollEnd');};},[pullUpDebounce,pullUp,bScroll]);useEffect(function(){if(!bScroll||!pullDown)return;bScroll.on('touchEnd',function(pos){//判断用户的下拉动作\nif(pos.y>50){pullDownDebounce();}});return function(){bScroll.off('touchEnd');};},[pullDownDebounce,pullDown,bScroll]);useEffect(function(){if(refresh&&bScroll){bScroll.refresh();}});useImperativeHandle(ref,function(){return{refresh:function refresh(){if(bScroll){bScroll.refresh();bScroll.scrollTo(0,0);}},getBScroll:function getBScroll(){if(bScroll){return bScroll;}}};});var PullUpdisplayStyle=pullUpLoading?{display:\"\"}:{display:\"none\"};var PullDowndisplayStyle=pullDownLoading?{display:\"\"}:{display:\"none\"};return/*#__PURE__*/_jsxs(ScrollContainer,{ref:scrollContaninerRef,children:[props.children,/*#__PURE__*/_jsx(PullUpLoading,{style:PullUpdisplayStyle,children:/*#__PURE__*/_jsx(Loading,{})}),/*#__PURE__*/_jsx(PullDownLoading,{style:PullDowndisplayStyle,children:/*#__PURE__*/_jsx(LoadingV2,{})})]});});Scroll.defaultProps={direction:\"vertical\",click:true,refresh:true,onScroll:null,pullUpLoading:false,pullDownLoading:false,pullUp:null,pullDown:null,bounceTop:true,bounceBottom:true};export default Scroll;","map":{"version":3,"sources":["C:/Users/86136/Desktop/学习进度/new_html/fullstack_yyf/react/cloud-music/src/baseUI/scroll/index.js"],"names":["React","forwardRef","useState","useEffect","useRef","useImperativeHandle","useMemo","BScroll","styled","Loading","debounce","LoadingV2","ScrollContainer","div","PullUpLoading","PullDownLoading","Scroll","props","ref","bScroll","setBScroll","scrollContaninerRef","direction","click","refresh","bounceTop","bounceBottom","pullUp","pullDown","onScroll","pullUpLoading","pullDownLoading","pullUpDebounce","pullDownDebounce","scroll","current","scrollX","scrollY","probeType","bounce","top","bottom","on","off","y","maxScrollY","pos","scrollTo","getBScroll","PullUpdisplayStyle","display","PullDowndisplayStyle","children","defaultProps"],"mappings":"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","sourcesContent":["import React, { forwardRef, useState,useEffect, useRef, useImperativeHandle, useMemo } from \"react\"\r\nimport PropTypes from \"prop-types\"\r\nimport BScroll from \"better-scroll\"\r\nimport styled from 'styled-components';\r\nimport Loading from '../loading';\r\nimport { debounce } from \"../../api/utils\";\r\nimport LoadingV2 from '../loading-v2';\r\n\r\nconst ScrollContainer = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n`;\r\n\r\nconst PullUpLoading = styled.div`\r\n  position: absolute;\r\n  left:0; right:0;\r\n  bottom: 5px;\r\n  width: 60px;\r\n  height: 60px;\r\n  margin: auto;\r\n  z-index: 100;\r\n`;\r\n\r\nexport const PullDownLoading = styled.div`\r\n  position: absolute;\r\n  left:0; right:0;\r\n  top: 0px;\r\n  height: 30px;\r\n  margin: auto;\r\n  z-index: 100;\r\n`;\r\n\r\nconst Scroll = forwardRef((props, ref) => {\r\n  const [bScroll, setBScroll] = useState();\r\n\r\n  const scrollContaninerRef = useRef();\r\n\r\n  const { direction, click, refresh,  bounceTop, bounceBottom } = props;\r\n\r\n  const { pullUp, pullDown, onScroll, pullUpLoading, pullDownLoading } = props;\r\n\r\n  let pullUpDebounce = useMemo(() => {\r\n    return debounce(pullUp, 300)\r\n  }, [pullUp]);\r\n  \r\n  let pullDownDebounce = useMemo(() => {\r\n    return debounce(pullDown, 300)\r\n  }, [pullDown]);\r\n\r\n  useEffect(() => {\r\n    const scroll = new BScroll(scrollContaninerRef.current, {\r\n      scrollX: direction === \"horizontal\",\r\n      scrollY: direction === \"vertical\",\r\n      probeType: 3,\r\n      click: click,\r\n      bounce:{\r\n        top: bounceTop,\r\n        bottom: bounceBottom\r\n      }\r\n    });\r\n    setBScroll(scroll);\r\n    return () => {\r\n      setBScroll(null);\r\n    }\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if(!bScroll || !onScroll) return;\r\n    bScroll.on('scroll', (scroll) => {\r\n      onScroll(scroll);\r\n    })\r\n    return () => {\r\n      bScroll.off('scroll');\r\n    }\r\n  }, [onScroll, bScroll]);\r\n\r\n  useEffect(() => {\r\n    if(!bScroll || !pullUp) return;\r\n    bScroll.on('scrollEnd', () => {\r\n      //判断是否滑动到了底部\r\n      if(bScroll.y <= bScroll.maxScrollY + 100){\r\n        pullUpDebounce();\r\n      }\r\n    });\r\n    return () => {\r\n      bScroll.off('scrollEnd');\r\n    }\r\n  }, [pullUpDebounce, pullUp, bScroll]);\r\n\r\n  useEffect(() => {\r\n    if(!bScroll || !pullDown) return;\r\n    bScroll.on('touchEnd', (pos) => {\r\n      //判断用户的下拉动作\r\n      if(pos.y > 50) {\r\n        pullDownDebounce();\r\n      }\r\n    });\r\n    return () => {\r\n      bScroll.off('touchEnd');\r\n    }\r\n  }, [pullDownDebounce, pullDown, bScroll]);\r\n\r\n\r\n  useEffect(() => {\r\n    if(refresh && bScroll){\r\n      bScroll.refresh();\r\n    }\r\n  });\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    refresh() {\r\n      if(bScroll) {\r\n        bScroll.refresh();\r\n        bScroll.scrollTo(0, 0);\r\n      }\r\n    },\r\n    getBScroll() {\r\n      if(bScroll) {\r\n        return bScroll;\r\n      }\r\n    }\r\n  }));\r\n\r\n  const PullUpdisplayStyle = pullUpLoading ? { display: \"\" } : { display: \"none\" };\r\n  const PullDowndisplayStyle = pullDownLoading ? { display: \"\" } : { display: \"none\" };\r\n  return (\r\n    <ScrollContainer ref={scrollContaninerRef}>\r\n      {props.children}\r\n      {/* 滑到底部加载动画 */}\r\n      <PullUpLoading style={ PullUpdisplayStyle }><Loading></Loading></PullUpLoading>\r\n      {/* 顶部下拉刷新动画 */}\r\n      <PullDownLoading style={ PullDowndisplayStyle }><LoadingV2></LoadingV2></PullDownLoading>\r\n    </ScrollContainer>\r\n  );\r\n})\r\n\r\nScroll.defaultProps = {\r\n  direction: \"vertical\",\r\n  click: true,\r\n  refresh: true,\r\n  onScroll:null,\r\n  pullUpLoading: false,\r\n  pullDownLoading: false,\r\n  pullUp: null,\r\n  pullDown: null,\r\n  bounceTop: true,\r\n  bounceBottom: true\r\n};\r\n\r\nScroll.propTypes = {\r\n  direction: PropTypes.oneOf(['vertical', 'horizontal']),\r\n  refresh: PropTypes.bool,\r\n  onScroll: PropTypes.func,\r\n  pullUp: PropTypes.func,\r\n  pullDown: PropTypes.func,\r\n  pullUpLoading: PropTypes.bool,\r\n  pullDownLoading: PropTypes.bool,\r\n  bounceTop: PropTypes.bool,//是否支持向上吸顶\r\n  bounceBottom: PropTypes.bool//是否支持向上吸顶\r\n};\r\n\r\nexport default Scroll;"]},"metadata":{},"sourceType":"module"}