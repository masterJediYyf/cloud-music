{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\86136\\\\Desktop\\\\\\u5B66\\u4E60\\u8FDB\\u5EA6\\\\new_html\\\\fullstack_yyf\\\\react\\\\cloud-music\\\\src\\\\application\\\\Album\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { Container, TopDesc, Menu } from './style';\nimport { CSSTransition } from 'react-transition-group';\nimport Header from './../../baseUI/header/index';\nimport Scroll from '../../baseUI/scroll/index';\nimport { getCount, isEmptyObject } from '../../api/utils';\nimport { HEADER_HEIGHT } from './../../api/config';\nimport style from \"../../assets/global-style\";\nimport { connect } from 'react-redux';\nimport { getAlbumList, changeEnterLoading } from './store/actionCreators';\nimport Loading from '../../baseUI/loading/index';\nimport SongsList from '../SongsList';\nimport MusicNote from \"../../baseUI/music-note/index\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Album(props) {\n  _s();\n\n  const [showStatus, setShowStatus] = useState(true);\n  const [title, setTitle] = useState(\"歌单\");\n  const [isMarquee, setIsMarquee] = useState(false); //是否跑马灯\n\n  const headerEl = useRef();\n  const musicNoteRef = useRef();\n  const {\n    currentAlbum: currentAlbumImmutable,\n    enterLoading,\n    songsCount\n  } = props;\n  const {\n    getAlbumDataDispatch\n  } = props;\n  const id = props.match.params.id;\n  useEffect(() => {\n    getAlbumDataDispatch(id);\n  }, [getAlbumDataDispatch, id]);\n  let currentAlbum = currentAlbumImmutable.toJS();\n  const handleBack = useCallback(() => {\n    setShowStatus(false);\n  }, []);\n  const handleScroll = useCallback(pos => {\n    let minScrollY = -HEADER_HEIGHT;\n    let percent = Math.abs(pos.y / minScrollY);\n    let headerDom = headerEl.current; //滑过顶部的高度开始变化\n\n    if (pos.y < minScrollY) {\n      headerDom.style.backgroundColor = style[\"theme-color\"];\n      headerDom.style.opacity = Math.min(1, (percent - 1) / 2);\n      setTitle(currentAlbum.name);\n      setIsMarquee(true);\n    } else {\n      headerDom.style.backgroundColor = \"\";\n      headerDom.style.opacity = 1;\n      setTitle(\"歌单\");\n      setIsMarquee(false);\n    }\n  }, [currentAlbum]);\n\n  const musicAnimation = (x, y) => {\n    musicNoteRef.current.startAnimation({\n      x,\n      y\n    });\n  };\n\n  const renderTopDesc = () => {\n    return /*#__PURE__*/_jsxDEV(TopDesc, {\n      background: currentAlbum.coverImgUrl,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"background\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"filter\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 64,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 63,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"img_wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"decorate\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: currentAlbum.coverImgUrl,\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"play_count\",\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"iconfont play\",\n            children: \"\\uE885\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"count\",\n            children: getCount(currentAlbum.subscribedCount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 71,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"desc_wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"title\",\n          children: currentAlbum.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"person\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"avatar\",\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: currentAlbum.creator.avatarUrl,\n              alt: \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 78,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"name\",\n            children: currentAlbum.creator.nickname\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderMenu = () => {\n    return /*#__PURE__*/_jsxDEV(Menu, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE6AD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }, this), \"\\u8BC4\\u8BBA\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE86F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 11\n        }, this), \"\\u70B9\\u8D5E\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE62D\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this), \"\\u6536\\u85CF\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE606\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 11\n        }, this), \"\\u66F4\\u591A\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(CSSTransition, {\n    in: showStatus,\n    timeout: 300,\n    classNames: \"fly\",\n    appear: true,\n    unmountOnExit: true,\n    onExited: props.history.goBack,\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      play: songsCount,\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        ref: headerEl,\n        title: title,\n        handleClick: handleBack,\n        isMarquee: isMarquee\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this), !isEmptyObject(currentAlbum) ? /*#__PURE__*/_jsxDEV(Scroll, {\n        bounceTop: false,\n        onScroll: handleScroll,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [renderTopDesc(), renderMenu(), /*#__PURE__*/_jsxDEV(SongsList, {\n            songs: currentAlbum.tracks,\n            collectCount: currentAlbum.subscribedCount,\n            showCollect: true,\n            showBackground: true,\n            musicAnimation: musicAnimation\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 13\n      }, this) : null, enterLoading ? /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 26\n      }, this) : null, /*#__PURE__*/_jsxDEV(MusicNote, {\n        ref: musicNoteRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 5\n  }, this);\n} // 映射Redux全局的state到组件的props上\n\n\n_s(Album, \"4ypYFvwXNCD9ky5WNQngj5MpTYE=\");\n\n_c = Album;\n\nconst mapStateToProps = state => ({\n  currentAlbum: state.getIn(['album', 'currentAlbum']),\n  enterLoading: state.getIn(['album', 'enterLoading']),\n  songsCount: state.getIn(['player', 'playList']).size\n}); // 映射dispatch到props上\n\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    getAlbumDataDispatch(id) {\n      dispatch(changeEnterLoading(true));\n      dispatch(getAlbumList(id));\n    }\n\n  };\n}; // 将ui组件包装成容器组件\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)( /*#__PURE__*/React.memo(Album));\n\nvar _c;\n\n$RefreshReg$(_c, \"Album\");","map":{"version":3,"sources":["C:/Users/86136/Desktop/学习进度/new_html/fullstack_yyf/react/cloud-music/src/application/Album/index.js"],"names":["React","useState","useCallback","useRef","useEffect","Container","TopDesc","Menu","CSSTransition","Header","Scroll","getCount","isEmptyObject","HEADER_HEIGHT","style","connect","getAlbumList","changeEnterLoading","Loading","SongsList","MusicNote","Album","props","showStatus","setShowStatus","title","setTitle","isMarquee","setIsMarquee","headerEl","musicNoteRef","currentAlbum","currentAlbumImmutable","enterLoading","songsCount","getAlbumDataDispatch","id","match","params","toJS","handleBack","handleScroll","pos","minScrollY","percent","Math","abs","y","headerDom","current","backgroundColor","opacity","min","name","musicAnimation","x","startAnimation","renderTopDesc","coverImgUrl","subscribedCount","creator","avatarUrl","nickname","renderMenu","history","goBack","tracks","mapStateToProps","state","getIn","size","mapDispatchToProps","dispatch","memo"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,WAA1B,EAAuCC,MAAvC,EAA+CC,SAA/C,QAAgE,OAAhE;AACA,SAASC,SAAT,EAAoBC,OAApB,EAA6BC,IAA7B,QAAyC,SAAzC;AACA,SAASC,aAAT,QAA8B,wBAA9B;AACA,OAAOC,MAAP,MAAmB,6BAAnB;AACA,OAAOC,MAAP,MAAmB,2BAAnB;AACA,SAASC,QAAT,EAAmBC,aAAnB,QAAwC,iBAAxC;AACA,SAASC,aAAT,QAA8B,oBAA9B;AACA,OAAOC,KAAP,MAAkB,2BAAlB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,YAAT,EAAuBC,kBAAvB,QAAiD,wBAAjD;AACA,OAAOC,OAAP,MAAoB,4BAApB;AACA,OAAOC,SAAP,MAAsB,cAAtB;AACA,OAAOC,SAAP,MAAsB,+BAAtB;;;AAEA,SAASC,KAAT,CAAeC,KAAf,EAAsB;AAAA;;AACpB,QAAM,CAACC,UAAD,EAAaC,aAAb,IAA8BvB,QAAQ,CAAC,IAAD,CAA5C;AACA,QAAM,CAACwB,KAAD,EAAQC,QAAR,IAAoBzB,QAAQ,CAAC,IAAD,CAAlC;AACA,QAAM,CAAC0B,SAAD,EAAYC,YAAZ,IAA4B3B,QAAQ,CAAC,KAAD,CAA1C,CAHoB,CAG8B;;AAElD,QAAM4B,QAAQ,GAAG1B,MAAM,EAAvB;AACA,QAAM2B,YAAY,GAAG3B,MAAM,EAA3B;AAEA,QAAM;AAAE4B,IAAAA,YAAY,EAAEC,qBAAhB;AAAuCC,IAAAA,YAAvC;AAAqDC,IAAAA;AAArD,MAAoEZ,KAA1E;AACA,QAAM;AAAEa,IAAAA;AAAF,MAA2Bb,KAAjC;AAEA,QAAMc,EAAE,GAAGd,KAAK,CAACe,KAAN,CAAYC,MAAZ,CAAmBF,EAA9B;AAEAhC,EAAAA,SAAS,CAAC,MAAM;AACd+B,IAAAA,oBAAoB,CAACC,EAAD,CAApB;AACD,GAFQ,EAEN,CAACD,oBAAD,EAAuBC,EAAvB,CAFM,CAAT;AAIA,MAAIL,YAAY,GAAGC,qBAAqB,CAACO,IAAtB,EAAnB;AAEA,QAAMC,UAAU,GAAGtC,WAAW,CAAC,MAAM;AACnCsB,IAAAA,aAAa,CAAC,KAAD,CAAb;AACD,GAF6B,EAE3B,EAF2B,CAA9B;AAIA,QAAMiB,YAAY,GAAGvC,WAAW,CAAEwC,GAAD,IAAS;AACxC,QAAIC,UAAU,GAAG,CAAC9B,aAAlB;AACA,QAAI+B,OAAO,GAAGC,IAAI,CAACC,GAAL,CAASJ,GAAG,CAACK,CAAJ,GAAQJ,UAAjB,CAAd;AACA,QAAIK,SAAS,GAAGnB,QAAQ,CAACoB,OAAzB,CAHwC,CAIxC;;AACA,QAAIP,GAAG,CAACK,CAAJ,GAAQJ,UAAZ,EAAwB;AACtBK,MAAAA,SAAS,CAAClC,KAAV,CAAgBoC,eAAhB,GAAkCpC,KAAK,CAAC,aAAD,CAAvC;AACAkC,MAAAA,SAAS,CAAClC,KAAV,CAAgBqC,OAAhB,GAA0BN,IAAI,CAACO,GAAL,CAAS,CAAT,EAAY,CAACR,OAAO,GAAG,CAAX,IAAgB,CAA5B,CAA1B;AACAlB,MAAAA,QAAQ,CAACK,YAAY,CAACsB,IAAd,CAAR;AACAzB,MAAAA,YAAY,CAAC,IAAD,CAAZ;AACD,KALD,MAKO;AACLoB,MAAAA,SAAS,CAAClC,KAAV,CAAgBoC,eAAhB,GAAkC,EAAlC;AACAF,MAAAA,SAAS,CAAClC,KAAV,CAAgBqC,OAAhB,GAA0B,CAA1B;AACAzB,MAAAA,QAAQ,CAAC,IAAD,CAAR;AACAE,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACD;AACF,GAhB+B,EAgB7B,CAACG,YAAD,CAhB6B,CAAhC;;AAkBA,QAAMuB,cAAc,GAAG,CAACC,CAAD,EAAIR,CAAJ,KAAU;AAC/BjB,IAAAA,YAAY,CAACmB,OAAb,CAAqBO,cAArB,CAAoC;AAAED,MAAAA,CAAF;AAAKR,MAAAA;AAAL,KAApC;AACD,GAFD;;AAIA,QAAMU,aAAa,GAAG,MAAM;AAC1B,wBACE,QAAC,OAAD;AAAS,MAAA,UAAU,EAAE1B,YAAY,CAAC2B,WAAlC;AAAA,8BACE;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA,+BACE;AAAK,UAAA,SAAS,EAAC;AAAf;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cADF,eAIE;AAAK,QAAA,SAAS,EAAC,aAAf;AAAA,gCACE;AAAK,UAAA,SAAS,EAAC;AAAf;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAK,UAAA,GAAG,EAAE3B,YAAY,CAAC2B,WAAvB;AAAoC,UAAA,GAAG,EAAC;AAAxC;AAAA;AAAA;AAAA;AAAA,gBAFF,eAGE;AAAK,UAAA,SAAS,EAAC,YAAf;AAAA,kCACE;AAAG,YAAA,SAAS,EAAC,eAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AAAM,YAAA,SAAS,EAAC,OAAhB;AAAA,sBAAyB/C,QAAQ,CAACoB,YAAY,CAAC4B,eAAd;AAAjC;AAAA;AAAA;AAAA;AAAA,kBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAHF;AAAA;AAAA;AAAA;AAAA;AAAA,cAJF,eAYE;AAAK,QAAA,SAAS,EAAC,cAAf;AAAA,gCACE;AAAK,UAAA,SAAS,EAAC,OAAf;AAAA,oBAAwB5B,YAAY,CAACsB;AAArC;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAK,UAAA,SAAS,EAAC,QAAf;AAAA,kCACE;AAAK,YAAA,SAAS,EAAC,QAAf;AAAA,mCACE;AAAK,cAAA,GAAG,EAAEtB,YAAY,CAAC6B,OAAb,CAAqBC,SAA/B;AAA0C,cAAA,GAAG,EAAC;AAA9C;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBADF,eAIE;AAAK,YAAA,SAAS,EAAC,MAAf;AAAA,sBAAuB9B,YAAY,CAAC6B,OAAb,CAAqBE;AAA5C;AAAA;AAAA;AAAA;AAAA,kBAJF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,cAZF;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AAwBD,GAzBD;;AA2BA,QAAMC,UAAU,GAAG,MAAM;AACvB,wBACE,QAAC,IAAD;AAAA,8BACE;AAAA,gCACE;AAAG,UAAA,SAAS,EAAC,UAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eAKE;AAAA,gCACE;AAAG,UAAA,SAAS,EAAC,UAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF;AAAA;AAAA;AAAA;AAAA;AAAA,cALF,eASE;AAAA,gCACE;AAAG,UAAA,SAAS,EAAC,UAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF;AAAA;AAAA;AAAA;AAAA;AAAA,cATF,eAaE;AAAA,gCACE;AAAG,UAAA,SAAS,EAAC,UAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF;AAAA;AAAA;AAAA;AAAA;AAAA,cAbF;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AAoBD,GArBD;;AAuBA,sBACE,QAAC,aAAD;AACE,IAAA,EAAE,EAAExC,UADN;AAEE,IAAA,OAAO,EAAE,GAFX;AAGE,IAAA,UAAU,EAAC,KAHb;AAIE,IAAA,MAAM,EAAE,IAJV;AAKE,IAAA,aAAa,MALf;AAME,IAAA,QAAQ,EAAED,KAAK,CAAC0C,OAAN,CAAcC,MAN1B;AAAA,2BAQE,QAAC,SAAD;AAAW,MAAA,IAAI,EAAE/B,UAAjB;AAAA,8BACE,QAAC,MAAD;AAAQ,QAAA,GAAG,EAAEL,QAAb;AAAuB,QAAA,KAAK,EAAEJ,KAA9B;AAAqC,QAAA,WAAW,EAAEe,UAAlD;AAA8D,QAAA,SAAS,EAAEb;AAAzE;AAAA;AAAA;AAAA;AAAA,cADF,EAEG,CAACf,aAAa,CAACmB,YAAD,CAAd,gBAEG,QAAC,MAAD;AACE,QAAA,SAAS,EAAE,KADb;AAEE,QAAA,QAAQ,EAAEU,YAFZ;AAAA,+BAIE;AAAA,qBACIgB,aAAa,EADjB,EAEIM,UAAU,EAFd,eAGE,QAAC,SAAD;AACE,YAAA,KAAK,EAAEhC,YAAY,CAACmC,MADtB;AAEE,YAAA,YAAY,EAAEnC,YAAY,CAAC4B,eAF7B;AAGE,YAAA,WAAW,EAAE,IAHf;AAIE,YAAA,cAAc,EAAE,IAJlB;AAKE,YAAA,cAAc,EAAEL;AALlB;AAAA;AAAA;AAAA;AAAA,kBAHF;AAAA;AAAA;AAAA;AAAA;AAAA;AAJF;AAAA;AAAA;AAAA;AAAA,cAFH,GAmBG,IArBN,EAuBIrB,YAAY,gBAAG,QAAC,OAAD;AAAA;AAAA;AAAA;AAAA,cAAH,GAAyB,IAvBzC,eAwBE,QAAC,SAAD;AAAW,QAAA,GAAG,EAAEH;AAAhB;AAAA;AAAA;AAAA;AAAA,cAxBF;AAAA;AAAA;AAAA;AAAA;AAAA;AARF;AAAA;AAAA;AAAA;AAAA,UADF;AAqCD,C,CAED;;;GAtIST,K;;KAAAA,K;;AAuIT,MAAM8C,eAAe,GAAIC,KAAD,KAAY;AAClCrC,EAAAA,YAAY,EAAEqC,KAAK,CAACC,KAAN,CAAY,CAAC,OAAD,EAAU,cAAV,CAAZ,CADoB;AAElCpC,EAAAA,YAAY,EAAEmC,KAAK,CAACC,KAAN,CAAY,CAAC,OAAD,EAAU,cAAV,CAAZ,CAFoB;AAGlCnC,EAAAA,UAAU,EAAEkC,KAAK,CAACC,KAAN,CAAY,CAAC,QAAD,EAAW,UAAX,CAAZ,EAAoCC;AAHd,CAAZ,CAAxB,C,CAKA;;;AACA,MAAMC,kBAAkB,GAAIC,QAAD,IAAc;AACvC,SAAO;AACLrC,IAAAA,oBAAoB,CAACC,EAAD,EAAK;AACvBoC,MAAAA,QAAQ,CAACvD,kBAAkB,CAAC,IAAD,CAAnB,CAAR;AACAuD,MAAAA,QAAQ,CAACxD,YAAY,CAACoB,EAAD,CAAb,CAAR;AACD;;AAJI,GAAP;AAMD,CAPD,C,CASA;;;AACA,eAAerB,OAAO,CAACoD,eAAD,EAAkBI,kBAAlB,CAAP,eAA6CvE,KAAK,CAACyE,IAAN,CAAWpD,KAAX,CAA7C,CAAf","sourcesContent":["import React, { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { Container, TopDesc, Menu } from './style';\r\nimport { CSSTransition } from 'react-transition-group';\r\nimport Header from './../../baseUI/header/index';\r\nimport Scroll from '../../baseUI/scroll/index';\r\nimport { getCount, isEmptyObject } from '../../api/utils';\r\nimport { HEADER_HEIGHT } from './../../api/config';\r\nimport style from \"../../assets/global-style\";\r\nimport { connect } from 'react-redux';\r\nimport { getAlbumList, changeEnterLoading } from './store/actionCreators';\r\nimport Loading from '../../baseUI/loading/index';\r\nimport SongsList from '../SongsList';\r\nimport MusicNote from \"../../baseUI/music-note/index\";\r\n\r\nfunction Album(props) {\r\n  const [showStatus, setShowStatus] = useState(true);\r\n  const [title, setTitle] = useState(\"歌单\");\r\n  const [isMarquee, setIsMarquee] = useState(false);//是否跑马灯\r\n\r\n  const headerEl = useRef();\r\n  const musicNoteRef = useRef();\r\n\r\n  const { currentAlbum: currentAlbumImmutable, enterLoading, songsCount } = props;\r\n  const { getAlbumDataDispatch } = props;\r\n\r\n  const id = props.match.params.id;\r\n\r\n  useEffect(() => {\r\n    getAlbumDataDispatch(id);\r\n  }, [getAlbumDataDispatch, id]);\r\n\r\n  let currentAlbum = currentAlbumImmutable.toJS();\r\n\r\n  const handleBack = useCallback(() => {\r\n    setShowStatus(false);\r\n  }, []);\r\n\r\n  const handleScroll = useCallback((pos) => {\r\n    let minScrollY = -HEADER_HEIGHT;\r\n    let percent = Math.abs(pos.y / minScrollY);\r\n    let headerDom = headerEl.current;\r\n    //滑过顶部的高度开始变化\r\n    if (pos.y < minScrollY) {\r\n      headerDom.style.backgroundColor = style[\"theme-color\"];\r\n      headerDom.style.opacity = Math.min(1, (percent - 1) / 2);\r\n      setTitle(currentAlbum.name);\r\n      setIsMarquee(true);\r\n    } else {\r\n      headerDom.style.backgroundColor = \"\";\r\n      headerDom.style.opacity = 1;\r\n      setTitle(\"歌单\");\r\n      setIsMarquee(false);\r\n    }\r\n  }, [currentAlbum]);\r\n\r\n  const musicAnimation = (x, y) => {\r\n    musicNoteRef.current.startAnimation({ x, y });\r\n  };\r\n  \r\n  const renderTopDesc = () => {\r\n    return (\r\n      <TopDesc background={currentAlbum.coverImgUrl}>\r\n        <div className=\"background\">\r\n          <div className=\"filter\"></div>\r\n        </div>\r\n        <div className=\"img_wrapper\">\r\n          <div className=\"decorate\"></div>\r\n          <img src={currentAlbum.coverImgUrl} alt=\"\" />\r\n          <div className=\"play_count\">\r\n            <i className=\"iconfont play\">&#xe885;</i>\r\n            <span className=\"count\">{getCount(currentAlbum.subscribedCount)}</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"desc_wrapper\">\r\n          <div className=\"title\">{currentAlbum.name}</div>\r\n          <div className=\"person\">\r\n            <div className=\"avatar\">\r\n              <img src={currentAlbum.creator.avatarUrl} alt=\"\" />\r\n            </div>\r\n            <div className=\"name\">{currentAlbum.creator.nickname}</div>\r\n          </div>\r\n        </div>\r\n      </TopDesc>\r\n    )\r\n  }\r\n\r\n  const renderMenu = () => {\r\n    return (\r\n      <Menu>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe6ad;</i>\r\n          评论\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe86f;</i>\r\n          点赞\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe62d;</i>\r\n          收藏\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe606;</i>\r\n          更多\r\n        </div>\r\n      </Menu>\r\n    )\r\n  };\r\n\r\n  return (\r\n    <CSSTransition\r\n      in={showStatus}\r\n      timeout={300}\r\n      classNames=\"fly\"\r\n      appear={true}\r\n      unmountOnExit\r\n      onExited={props.history.goBack}\r\n    >\r\n      <Container play={songsCount}>\r\n        <Header ref={headerEl} title={title} handleClick={handleBack} isMarquee={isMarquee}></Header>\r\n        {!isEmptyObject(currentAlbum) ?\r\n          (\r\n            <Scroll\r\n              bounceTop={false}\r\n              onScroll={handleScroll}\r\n            >\r\n              <div>\r\n                { renderTopDesc() }\r\n                { renderMenu() }\r\n                <SongsList\r\n                  songs={currentAlbum.tracks}\r\n                  collectCount={currentAlbum.subscribedCount}\r\n                  showCollect={true}\r\n                  showBackground={true}\r\n                  musicAnimation={musicAnimation}\r\n                ></SongsList>\r\n              </div>\r\n            </Scroll>\r\n          )\r\n          : null\r\n        }\r\n        { enterLoading ? <Loading></Loading> : null}\r\n        <MusicNote ref={musicNoteRef}></MusicNote>\r\n      </Container>\r\n    </CSSTransition>\r\n  )\r\n}\r\n\r\n// 映射Redux全局的state到组件的props上\r\nconst mapStateToProps = (state) => ({\r\n  currentAlbum: state.getIn(['album', 'currentAlbum']),\r\n  enterLoading: state.getIn(['album', 'enterLoading']),\r\n  songsCount: state.getIn(['player', 'playList']).size\r\n});\r\n// 映射dispatch到props上\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    getAlbumDataDispatch(id) {\r\n      dispatch(changeEnterLoading(true));\r\n      dispatch(getAlbumList(id));\r\n    },\r\n  }\r\n};\r\n\r\n// 将ui组件包装成容器组件\r\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Album));"]},"metadata":{},"sourceType":"module"}