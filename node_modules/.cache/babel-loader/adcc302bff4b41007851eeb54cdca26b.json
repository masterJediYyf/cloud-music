{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\86136\\\\Desktop\\\\\\u5B66\\u4E60\\u8FDB\\u5EA6\\\\new_html\\\\fullstack_yyf\\\\react\\\\cloud-music\\\\src\\\\application\\\\Singer\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport { Container } from \"./style\";\nimport Header from \"../../baseUI/header/index\";\nimport { ImgWrapper, CollectButton, SongListWrapper, BgLayer } from \"./style\";\nimport Scroll from \"../../baseUI/scroll/index\";\nimport { HEADER_HEIGHT } from \"./../../api/config\";\nimport { getSingerInfo } from \"./store/actionCreators\";\nimport { connect } from \"react-redux\";\nimport Loading from \"./../../baseUI/loading/index\";\nimport { EnterLoading } from \"../Singers/style\";\nimport { changeEnterLoading } from \"./store/actionCreators\";\nimport { CSSTransition } from \"react-transition-group\";\nimport SongsList from \"../SongList/\";\nimport MusicNote from \"../../baseUI/music-note/index\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Singer(props) {\n  _s();\n\n  const initialHeight = useRef(0);\n  const [showStatus, setShowStatus] = useState(true);\n  const OFFSET = 5;\n  const {\n    artist: immutableArtist,\n    songs: immutableSongs,\n    loading,\n    songsCount\n  } = props;\n  const {\n    getSingerDataDispatch\n  } = props;\n  const artist = immutableArtist.toJS();\n  const songs = immutableSongs.toJS();\n  const collectButton = useRef();\n  const imageWrapper = useRef();\n  const songScrollWrapper = useRef();\n  const songScroll = useRef();\n  const header = useRef();\n  const layer = useRef();\n  const musicNoteRef = useRef();\n  useEffect(() => {\n    const id = props.match.params.id;\n    getSingerDataDispatch(id);\n    let h = imageWrapper.current.offsetHeight;\n    initialHeight.current = h;\n    songScrollWrapper.current.style.top = `${h - OFFSET}px`; //把遮罩先放在下面，以裹住歌曲列表\n\n    layer.current.style.top = `${h - OFFSET}px`;\n    songScroll.current.refresh(); // eslint-disable-next-line\n  }, []);\n\n  const handleScroll = pos => {\n    let height = initialHeight.current;\n    const newY = pos.y;\n    const imageDOM = imageWrapper.current;\n    const buttonDOM = collectButton.current;\n    const headerDOM = header.current;\n    const layerDOM = layer.current;\n    const minScrollY = -(height - OFFSET) + HEADER_HEIGHT;\n    const percent = Math.abs(newY / height); //说明: 在歌手页的布局中，歌单列表其实是没有自己的背景的，layerDOM其实是起一个遮罩的作用，给歌单内容提供白色背景\n    //因此在处理的过程中，随着内容的滚动，遮罩也跟着移动\n\n    if (newY > 0) {\n      //处理往下拉的情况,效果：图片放大，按钮跟着偏移\n      imageDOM.style[\"transform\"] = `scale(${1 + percent})`;\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\n      layerDOM.style.top = `${height - OFFSET + newY}px`;\n    } else if (newY >= minScrollY) {\n      //往上滑动，但是还没超过Header部分\n      layerDOM.style.top = `${height - OFFSET - Math.abs(newY)}px`;\n      layerDOM.style.zIndex = 1;\n      imageDOM.style.paddingTop = \"75%\";\n      imageDOM.style.height = 0;\n      imageDOM.style.zIndex = -1;\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\n      buttonDOM.style[\"opacity\"] = `${1 - percent * 2}`;\n    } else if (newY < minScrollY) {\n      //往上滑动，但是超过Header部分\n      layerDOM.style.top = `${HEADER_HEIGHT - OFFSET}px`;\n      layerDOM.style.zIndex = 1; //防止溢出的歌单内容遮住Header\n\n      headerDOM.style.zIndex = 100; //此时图片高度与Header一致\n\n      imageDOM.style.height = `${HEADER_HEIGHT}px`;\n      imageDOM.style.paddingTop = 0;\n      imageDOM.style.zIndex = 99;\n    }\n  };\n\n  const musicAnimation = (x, y) => {\n    musicNoteRef.current.startAnimation({\n      x,\n      y\n    });\n  };\n\n  const setShowStatusFalse = useCallback(() => {\n    setShowStatus(false);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(CSSTransition, {\n    in: showStatus,\n    timeout: 300,\n    classNames: \"fly\",\n    appear: true,\n    unmountOnExit: true,\n    onExited: () => props.history.goBack(),\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        handleClick: setShowStatusFalse,\n        title: artist.name,\n        ref: header\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ImgWrapper, {\n        ref: imageWrapper,\n        bgUrl: artist.picUrl,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"filter\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CollectButton, {\n        ref: collectButton,\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE62D\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text\",\n          children: \"\\u6536\\u85CF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(BgLayer, {\n        ref: layer\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SongListWrapper, {\n        ref: songScrollWrapper,\n        play: songsCount,\n        children: /*#__PURE__*/_jsxDEV(Scroll, {\n          onScroll: handleScroll,\n          ref: songScroll,\n          children: /*#__PURE__*/_jsxDEV(SongsList, {\n            songs: songs,\n            showCollect: false,\n            usePageSplit: false,\n            musicAnimation: musicAnimation\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this), loading ? /*#__PURE__*/_jsxDEV(EnterLoading, {\n        style: {\n          zIndex: 100\n        },\n        children: /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 11\n      }, this) : null, /*#__PURE__*/_jsxDEV(MusicNote, {\n        ref: musicNoteRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this);\n} // 映射Redux全局的state到组件的props上\n\n\n_s(Singer, \"P3v7Ne0L2tlO9zf7MPZvP6GFhOI=\");\n\n_c = Singer;\n\nconst mapStateToProps = state => ({\n  artist: state.getIn([\"singerInfo\", \"artist\"]),\n  songs: state.getIn([\"singerInfo\", \"songsOfArtist\"]),\n  loading: state.getIn([\"singerInfo\", \"loading\"]),\n  songsCount: state.getIn([\"player\", \"playList\"]).size\n}); // 映射dispatch到props上\n\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    getSingerDataDispatch(id) {\n      dispatch(changeEnterLoading(true));\n      dispatch(getSingerInfo(id));\n    }\n\n  };\n}; // 将ui组件包装成容器组件\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)( /*#__PURE__*/React.memo(Singer));\n\nvar _c;\n\n$RefreshReg$(_c, \"Singer\");","map":{"version":3,"sources":["C:/Users/86136/Desktop/学习进度/new_html/fullstack_yyf/react/cloud-music/src/application/Singer/index.js"],"names":["React","useState","useEffect","useRef","useCallback","Container","Header","ImgWrapper","CollectButton","SongListWrapper","BgLayer","Scroll","HEADER_HEIGHT","getSingerInfo","connect","Loading","EnterLoading","changeEnterLoading","CSSTransition","SongsList","MusicNote","Singer","props","initialHeight","showStatus","setShowStatus","OFFSET","artist","immutableArtist","songs","immutableSongs","loading","songsCount","getSingerDataDispatch","toJS","collectButton","imageWrapper","songScrollWrapper","songScroll","header","layer","musicNoteRef","id","match","params","h","current","offsetHeight","style","top","refresh","handleScroll","pos","height","newY","y","imageDOM","buttonDOM","headerDOM","layerDOM","minScrollY","percent","Math","abs","zIndex","paddingTop","musicAnimation","x","startAnimation","setShowStatusFalse","history","goBack","name","picUrl","mapStateToProps","state","getIn","size","mapDispatchToProps","dispatch","memo"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\r\nimport { Container } from \"./style\";\r\nimport Header from \"../../baseUI/header/index\";\r\nimport { ImgWrapper, CollectButton, SongListWrapper, BgLayer } from \"./style\";\r\nimport Scroll from \"../../baseUI/scroll/index\";\r\nimport { HEADER_HEIGHT } from \"./../../api/config\";\r\nimport { getSingerInfo } from \"./store/actionCreators\";\r\nimport { connect } from \"react-redux\";\r\nimport Loading from \"./../../baseUI/loading/index\";\r\nimport { EnterLoading } from \"../Singers/style\";\r\nimport { changeEnterLoading } from \"./store/actionCreators\";\r\nimport { CSSTransition } from \"react-transition-group\";\r\nimport SongsList from \"../SongList/\";\r\nimport MusicNote from \"../../baseUI/music-note/index\";\r\n\r\nfunction Singer(props) {\r\n  const initialHeight = useRef(0);\r\n  const [showStatus, setShowStatus] = useState(true);\r\n\r\n  const OFFSET = 5;\r\n\r\n  const { \r\n    artist: immutableArtist, \r\n    songs: immutableSongs, \r\n    loading,\r\n    songsCount\r\n  } = props;\r\n\r\n  const { getSingerDataDispatch } = props;\r\n\r\n  const artist = immutableArtist.toJS();\r\n  const songs = immutableSongs.toJS();\r\n\r\n  const collectButton = useRef();\r\n  const imageWrapper = useRef();\r\n  const songScrollWrapper = useRef();\r\n  const songScroll = useRef();\r\n  const header = useRef();\r\n  const layer = useRef();\r\n  const musicNoteRef = useRef();\r\n\r\n  useEffect(() => {\r\n    const id = props.match.params.id;\r\n    getSingerDataDispatch(id);\r\n    let h = imageWrapper.current.offsetHeight;\r\n    initialHeight.current = h;\r\n    songScrollWrapper.current.style.top = `${h - OFFSET}px`;\r\n    //把遮罩先放在下面，以裹住歌曲列表\r\n    layer.current.style.top = `${h - OFFSET}px`;\r\n    songScroll.current.refresh();\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  const handleScroll = pos => {\r\n    let height = initialHeight.current;\r\n    const newY = pos.y;\r\n    const imageDOM = imageWrapper.current;\r\n    const buttonDOM = collectButton.current;\r\n    const headerDOM = header.current;\r\n    const layerDOM = layer.current;\r\n    const minScrollY = -(height - OFFSET) + HEADER_HEIGHT;\r\n\r\n    const percent = Math.abs(newY / height);\r\n    //说明: 在歌手页的布局中，歌单列表其实是没有自己的背景的，layerDOM其实是起一个遮罩的作用，给歌单内容提供白色背景\r\n    //因此在处理的过程中，随着内容的滚动，遮罩也跟着移动\r\n    if (newY > 0) {\r\n      //处理往下拉的情况,效果：图片放大，按钮跟着偏移\r\n      imageDOM.style[\"transform\"] = `scale(${1 + percent})`;\r\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\r\n      layerDOM.style.top = `${height - OFFSET + newY}px`;\r\n    } else if (newY >= minScrollY) {\r\n      //往上滑动，但是还没超过Header部分\r\n      layerDOM.style.top = `${height - OFFSET - Math.abs(newY)}px`;\r\n      layerDOM.style.zIndex = 1;\r\n      imageDOM.style.paddingTop = \"75%\";\r\n      imageDOM.style.height = 0;\r\n      imageDOM.style.zIndex = -1;\r\n      buttonDOM.style[\"transform\"] = `translate3d(0, ${newY}px, 0)`;\r\n      buttonDOM.style[\"opacity\"] = `${1 - percent * 2}`;\r\n    } else if (newY < minScrollY) {\r\n      //往上滑动，但是超过Header部分\r\n      layerDOM.style.top = `${HEADER_HEIGHT - OFFSET}px`;\r\n      layerDOM.style.zIndex = 1;\r\n      //防止溢出的歌单内容遮住Header\r\n      headerDOM.style.zIndex = 100;\r\n      //此时图片高度与Header一致\r\n      imageDOM.style.height = `${HEADER_HEIGHT}px`;\r\n      imageDOM.style.paddingTop = 0;\r\n      imageDOM.style.zIndex = 99;\r\n    }\r\n  };\r\n\r\n  const musicAnimation = (x, y) => {\r\n    musicNoteRef.current.startAnimation({ x, y });\r\n  };\r\n\r\n  const setShowStatusFalse = useCallback(() => {\r\n    setShowStatus(false);\r\n  }, [])\r\n\r\n  return (\r\n    <CSSTransition\r\n      in={showStatus}\r\n      timeout={300}\r\n      classNames=\"fly\"\r\n      appear={true}\r\n      unmountOnExit\r\n      onExited={() => props.history.goBack()}\r\n    >\r\n      <Container>\r\n        <Header\r\n          handleClick={setShowStatusFalse}\r\n          title={artist.name}\r\n          ref={header}\r\n        ></Header>\r\n        <ImgWrapper ref={imageWrapper} bgUrl={artist.picUrl}>\r\n          <div className=\"filter\"></div>\r\n        </ImgWrapper>\r\n        <CollectButton ref={collectButton}>\r\n          <i className=\"iconfont\">&#xe62d;</i>\r\n          <span className=\"text\">收藏</span>\r\n        </CollectButton>\r\n        <BgLayer ref={layer}></BgLayer>\r\n        <SongListWrapper ref={songScrollWrapper} play={songsCount}>\r\n          <Scroll onScroll={handleScroll} ref={songScroll}>\r\n            <SongsList\r\n              songs={songs}\r\n              showCollect={false}\r\n              usePageSplit={false}\r\n              musicAnimation={musicAnimation}\r\n            ></SongsList>\r\n          </Scroll>\r\n        </SongListWrapper>\r\n        {loading ? (\r\n          <EnterLoading style={{ zIndex: 100 }}>\r\n            <Loading></Loading>\r\n          </EnterLoading>\r\n        ) : null}\r\n        <MusicNote ref={musicNoteRef}></MusicNote>\r\n      </Container>\r\n    </CSSTransition>\r\n  );\r\n}\r\n\r\n// 映射Redux全局的state到组件的props上\r\nconst mapStateToProps = state => ({\r\n  artist: state.getIn([\"singerInfo\", \"artist\"]),\r\n  songs: state.getIn([\"singerInfo\", \"songsOfArtist\"]),\r\n  loading: state.getIn([\"singerInfo\", \"loading\"]),\r\n  songsCount: state.getIn([\"player\", \"playList\"]).size\r\n});\r\n// 映射dispatch到props上\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    getSingerDataDispatch(id) {\r\n      dispatch(changeEnterLoading(true));\r\n      dispatch(getSingerInfo(id));\r\n    }\r\n  };\r\n};\r\n\r\n// 将ui组件包装成容器组件\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(React.memo(Singer));\r\n"]},"metadata":{},"sourceType":"module"}