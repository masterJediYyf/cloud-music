{"ast":null,"code":"import React,{useEffect,useContext}from'react';import Horizen from'../../baseUI/horizen-item';import{categoryTypes,alphaTypes}from'../../api/config';import{NavContainer,ListContainer,List,ListItem}from\"./style\";import{getSingerList,getHotSingerList,changeEnterLoading,changePageCount,refreshMoreSingerList,changePullUpLoading,changePullDownLoading,refreshMoreHotSingerList}from'./store/actionCreators';import LazyLoad,{forceCheck}from'react-lazyload';import Scroll from'./../../baseUI/scroll/index';import{connect}from'react-redux';import Loading from'../../baseUI/loading';import{renderRoutes}from'react-router-config';import{CHANGE_CATEGORY,CHANGE_ALPHA,CategoryDataContext}from'./data';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Singers(props){var _useContext=useContext(CategoryDataContext),data=_useContext.data,dispatch=_useContext.dispatch;//拿到 category 和 alpha 的值\nvar _data$toJS=data.toJS(),category=_data$toJS.category,alpha=_data$toJS.alpha;var singerList=props.singerList,enterLoading=props.enterLoading,pullUpLoading=props.pullUpLoading,pullDownLoading=props.pullDownLoading,pageCount=props.pageCount;var getHotSingerDispatch=props.getHotSingerDispatch,updateDispatch=props.updateDispatch,pullDownRefreshDispatch=props.pullDownRefreshDispatch,pullUpRefreshDispatch=props.pullUpRefreshDispatch;// 歌手列表页的数据缓存\nuseEffect(function(){if(!singerList.size){getHotSingerDispatch();}// eslint-disable-next-line\n},[]);var handleUpdateAlpha=function handleUpdateAlpha(val){dispatch({type:CHANGE_ALPHA,data:val});updateDispatch(category,val);};var handleUpdateCatetory=function handleUpdateCatetory(val){dispatch({type:CHANGE_CATEGORY,data:val});updateDispatch(val,alpha);};var handlePullUp=function handlePullUp(){pullUpRefreshDispatch(category,alpha,category==='',pageCount);};var handlePullDown=function handlePullDown(){pullDownRefreshDispatch(category,alpha);};var enterDetail=function enterDetail(id){props.history.push(\"/singers/\".concat(id));};var renderSingerList=function renderSingerList(){var list=singerList?singerList.toJS():[];console.log(props);return/*#__PURE__*/_jsx(List,{children:list.map(function(item,index){return/*#__PURE__*/_jsxs(ListItem,{onClick:function onClick(){return enterDetail(item.id);},children:[/*#__PURE__*/_jsx(\"div\",{className:\"img_wrapper\",children:/*#__PURE__*/_jsx(LazyLoad,{placeholder:/*#__PURE__*/_jsx(\"img\",{width:\"100%\",height:\"100%\",src:require('./singer.png'),alt:\"music\"}),children:/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(item.picUrl,\"?param=300x300\"),width:\"100%\",height:\"100%\",alt:\"music\"})})}),/*#__PURE__*/_jsx(\"span\",{className:\"name\",children:item.name})]},item.accountId+\"\"+index);})});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(NavContainer,{children:[/*#__PURE__*/_jsx(Horizen,{list:categoryTypes,title:\"分类(默认热门):\",handleClick:function handleClick(val){return handleUpdateCatetory(val);},oldVal:category}),/*#__PURE__*/_jsx(Horizen,{list:alphaTypes,title:\"首字母:\",handleClick:function handleClick(val){return handleUpdateAlpha(val);},oldVal:alpha})]}),/*#__PURE__*/_jsxs(ListContainer,{children:[/*#__PURE__*/_jsx(Scroll,{pullUp:handlePullUp,pullDown:handlePullDown,pullUpLoading:pullUpLoading,pullDownLoading:pullDownLoading,onScroll:forceCheck,children:renderSingerList()}),/*#__PURE__*/_jsx(Loading,{show:enterLoading})]}),renderRoutes(props.route.routes)]});}var mapStateToProps=function mapStateToProps(state){return{singerList:state.getIn(['singers','singerList']),enterLoading:state.getIn(['singers','enterLoading']),pullUpLoading:state.getIn(['singers','pullUpLoading']),pullDownLoading:state.getIn(['singers','pullDownLoading']),pageCount:state.getIn(['singers','pageCount'])};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{getHotSingerDispatch:function getHotSingerDispatch(){dispatch(getHotSingerList());},updateDispatch:function updateDispatch(category,alpha){dispatch(changePageCount(0));dispatch(changeEnterLoading(true));dispatch(getSingerList(category,alpha));},// 滑到最底部刷新部分的处理\npullUpRefreshDispatch:function pullUpRefreshDispatch(category,alpha,hot,count){dispatch(changePullUpLoading(true));dispatch(changePageCount(count+1));if(hot){dispatch(refreshMoreHotSingerList());}else{dispatch(refreshMoreSingerList(category,alpha));}},//顶部下拉刷新\npullDownRefreshDispatch:function pullDownRefreshDispatch(category,alpha){dispatch(changePullDownLoading(true));dispatch(changePageCount(0));if(category===''&&alpha===''){dispatch(getHotSingerList());}else{dispatch(getSingerList(category,alpha));}}};};export default connect(mapStateToProps,mapDispatchToProps)(Singers);","map":{"version":3,"sources":["C:/Users/86136/Desktop/学习进度/new_html/fullstack_yyf/react/cloud-music/src/application/Singers/index.js"],"names":["React","useEffect","useContext","Horizen","categoryTypes","alphaTypes","NavContainer","ListContainer","List","ListItem","getSingerList","getHotSingerList","changeEnterLoading","changePageCount","refreshMoreSingerList","changePullUpLoading","changePullDownLoading","refreshMoreHotSingerList","LazyLoad","forceCheck","Scroll","connect","Loading","renderRoutes","CHANGE_CATEGORY","CHANGE_ALPHA","CategoryDataContext","Singers","props","data","dispatch","toJS","category","alpha","singerList","enterLoading","pullUpLoading","pullDownLoading","pageCount","getHotSingerDispatch","updateDispatch","pullDownRefreshDispatch","pullUpRefreshDispatch","size","handleUpdateAlpha","val","type","handleUpdateCatetory","handlePullUp","handlePullDown","enterDetail","id","history","push","renderSingerList","list","console","log","map","item","index","require","picUrl","name","accountId","route","routes","mapStateToProps","state","getIn","mapDispatchToProps","hot","count"],"mappings":"AAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA0BC,UAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,OAAP,KAAoB,2BAApB,CACA,OAASC,aAAT,CAAwBC,UAAxB,KAA0C,kBAA1C,CACA,OACEC,YADF,CAEEC,aAFF,CAGEC,IAHF,CAIEC,QAJF,KAKO,SALP,CAMA,OACEC,aADF,CAEEC,gBAFF,CAGEC,kBAHF,CAIEC,eAJF,CAKEC,qBALF,CAMEC,mBANF,CAOEC,qBAPF,CAQEC,wBARF,KASO,wBATP,CAUA,MAAQC,CAAAA,QAAR,EAAmBC,UAAnB,KAAoC,gBAApC,CACA,MAAOC,CAAAA,MAAP,KAAmB,6BAAnB,CACA,OAAQC,OAAR,KAAsB,aAAtB,CACA,MAAOC,CAAAA,OAAP,KAAoB,sBAApB,CACA,OAAQC,YAAR,KAA2B,qBAA3B,CACA,OAASC,eAAT,CAAyBC,YAAzB,CAAuCC,mBAAvC,KAAiE,QAAjE,C,wFAEA,QAASC,CAAAA,OAAT,CAAiBC,KAAjB,CAAwB,iBACE1B,UAAU,CAACwB,mBAAD,CADZ,CACfG,IADe,aACfA,IADe,CACVC,QADU,aACVA,QADU,CAEtB;AAFsB,eAGGD,IAAI,CAACE,IAAL,EAHH,CAGfC,QAHe,YAGfA,QAHe,CAGNC,KAHM,YAGNA,KAHM,IAKdC,CAAAA,UALc,CAK0DN,KAL1D,CAKdM,UALc,CAKFC,YALE,CAK0DP,KAL1D,CAKFO,YALE,CAKYC,aALZ,CAK0DR,KAL1D,CAKYQ,aALZ,CAK2BC,eAL3B,CAK0DT,KAL1D,CAK2BS,eAL3B,CAK4CC,SAL5C,CAK0DV,KAL1D,CAK4CU,SAL5C,IAOdC,CAAAA,oBAPc,CAO2EX,KAP3E,CAOdW,oBAPc,CAOQC,cAPR,CAO2EZ,KAP3E,CAOQY,cAPR,CAOwBC,uBAPxB,CAO2Eb,KAP3E,CAOwBa,uBAPxB,CAOiDC,qBAPjD,CAO2Ed,KAP3E,CAOiDc,qBAPjD,CAStB;AACAzC,SAAS,CAAC,UAAM,CACd,GAAG,CAACiC,UAAU,CAACS,IAAf,CAAoB,CAClBJ,oBAAoB,GACrB,CACD;AACD,CALQ,CAKN,EALM,CAAT,CAOA,GAAIK,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,GAAD,CAAS,CAC/Bf,QAAQ,CAAC,CAACgB,IAAI,CAACrB,YAAN,CAAmBI,IAAI,CAACgB,GAAxB,CAAD,CAAR,CACAL,cAAc,CAACR,QAAD,CAAWa,GAAX,CAAd,CACD,CAHD,CAKA,GAAIE,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACF,GAAD,CAAS,CAClCf,QAAQ,CAAC,CAACgB,IAAI,CAACtB,eAAN,CAAsBK,IAAI,CAACgB,GAA3B,CAAD,CAAR,CACAL,cAAc,CAACK,GAAD,CAAMZ,KAAN,CAAd,CACD,CAHD,CAKA,GAAMe,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzBN,qBAAqB,CAACV,QAAD,CAAWC,KAAX,CAAkBD,QAAQ,GAAK,EAA/B,CAAmCM,SAAnC,CAArB,CACD,CAFD,CAIA,GAAMW,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CAC3BR,uBAAuB,CAACT,QAAD,CAAWC,KAAX,CAAvB,CACD,CAFD,CAIA,GAAMiB,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,EAAD,CAAQ,CAC1BvB,KAAK,CAACwB,OAAN,CAAcC,IAAd,oBAA+BF,EAA/B,GACD,CAFD,CAIA,GAAMG,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,EAAM,CAC7B,GAAMC,CAAAA,IAAI,CAAGrB,UAAU,CAAGA,UAAU,CAACH,IAAX,EAAH,CAAsB,EAA7C,CACAyB,OAAO,CAACC,GAAR,CAAY7B,KAAZ,EACA,mBACE,KAAC,IAAD,WAEI2B,IAAI,CAACG,GAAL,CAAS,SAACC,IAAD,CAAOC,KAAP,CAAiB,CACxB,mBACE,MAAC,QAAD,EAAwC,OAAO,CAAE,yBAAMV,CAAAA,WAAW,CAACS,IAAI,CAACR,EAAN,CAAjB,EAAjD,wBACE,YAAK,SAAS,CAAC,aAAf,uBACE,KAAC,QAAD,EAAU,WAAW,cAAE,YAAK,KAAK,CAAC,MAAX,CAAkB,MAAM,CAAC,MAAzB,CAAgC,GAAG,CAAEU,OAAO,CAAC,cAAD,CAA5C,CAA8D,GAAG,CAAC,OAAlE,EAAvB,uBACE,YAAK,GAAG,WAAKF,IAAI,CAACG,MAAV,kBAAR,CAA0C,KAAK,CAAC,MAAhD,CAAuD,MAAM,CAAC,MAA9D,CAAqE,GAAG,CAAC,OAAzE,EADF,EADF,EADF,cAME,aAAM,SAAS,CAAC,MAAhB,UAAwBH,IAAI,CAACI,IAA7B,EANF,GAAeJ,IAAI,CAACK,SAAL,CAAe,EAAf,CAAkBJ,KAAjC,CADF,CAUD,CAXD,CAFJ,EADF,CAkBD,CArBD,CAuBA,mBACE,oCACE,MAAC,YAAD,yBACE,KAAC,OAAD,EAAS,IAAI,CAAExD,aAAf,CAA8B,KAAK,CAAE,WAArC,CAAkD,WAAW,CAAE,qBAACyC,GAAD,QAASE,CAAAA,oBAAoB,CAACF,GAAD,CAA7B,EAA/D,CAAmG,MAAM,CAAEb,QAA3G,EADF,cAEE,KAAC,OAAD,EAAS,IAAI,CAAE3B,UAAf,CAA2B,KAAK,CAAE,MAAlC,CAA0C,WAAW,CAAE,qBAAAwC,GAAG,QAAID,CAAAA,iBAAiB,CAACC,GAAD,CAArB,EAA1D,CAAsF,MAAM,CAAEZ,KAA9F,EAFF,GADF,cAKE,MAAC,aAAD,yBACE,KAAC,MAAD,EACE,MAAM,CAAGe,YADX,CAEE,QAAQ,CAAKC,cAFf,CAGE,aAAa,CAAKb,aAHpB,CAIE,eAAe,CAAKC,eAJtB,CAKE,QAAQ,CAAElB,UALZ,UAOImC,gBAAgB,EAPpB,EADF,cAUE,KAAC,OAAD,EAAS,IAAI,CAAEnB,YAAf,EAVF,GALF,CAiBGZ,YAAY,CAACK,KAAK,CAACqC,KAAN,CAAYC,MAAb,CAjBf,GADF,CAqBD,CAED,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,KAAD,QAAY,CAClClC,UAAU,CAAEkC,KAAK,CAACC,KAAN,CAAY,CAAC,SAAD,CAAY,YAAZ,CAAZ,CADsB,CAElClC,YAAY,CAAEiC,KAAK,CAACC,KAAN,CAAY,CAAC,SAAD,CAAY,cAAZ,CAAZ,CAFoB,CAGlCjC,aAAa,CAAEgC,KAAK,CAACC,KAAN,CAAY,CAAC,SAAD,CAAY,eAAZ,CAAZ,CAHmB,CAIlChC,eAAe,CAAE+B,KAAK,CAACC,KAAN,CAAY,CAAC,SAAD,CAAY,iBAAZ,CAAZ,CAJiB,CAKlC/B,SAAS,CAAE8B,KAAK,CAACC,KAAN,CAAY,CAAC,SAAD,CAAY,WAAZ,CAAZ,CALuB,CAAZ,EAAxB,CAOA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACxC,QAAD,CAAc,CACvC,MAAO,CACLS,oBADK,gCACkB,CACrBT,QAAQ,CAACnB,gBAAgB,EAAjB,CAAR,CACD,CAHI,CAIL6B,cAJK,yBAIUR,QAJV,CAIoBC,KAJpB,CAI2B,CAC9BH,QAAQ,CAACjB,eAAe,CAAC,CAAD,CAAhB,CAAR,CACAiB,QAAQ,CAAClB,kBAAkB,CAAC,IAAD,CAAnB,CAAR,CACAkB,QAAQ,CAACpB,aAAa,CAACsB,QAAD,CAAWC,KAAX,CAAd,CAAR,CACD,CARI,CASL;AACAS,qBAVK,gCAUiBV,QAVjB,CAU2BC,KAV3B,CAUkCsC,GAVlC,CAUuCC,KAVvC,CAU8C,CACjD1C,QAAQ,CAACf,mBAAmB,CAAC,IAAD,CAApB,CAAR,CACAe,QAAQ,CAACjB,eAAe,CAAC2D,KAAK,CAAC,CAAP,CAAhB,CAAR,CACA,GAAGD,GAAH,CAAO,CACLzC,QAAQ,CAACb,wBAAwB,EAAzB,CAAR,CACD,CAFD,IAEO,CACLa,QAAQ,CAAChB,qBAAqB,CAACkB,QAAD,CAAWC,KAAX,CAAtB,CAAR,CACD,CACF,CAlBI,CAmBL;AACAQ,uBApBK,kCAoBmBT,QApBnB,CAoB6BC,KApB7B,CAoBoC,CACvCH,QAAQ,CAACd,qBAAqB,CAAC,IAAD,CAAtB,CAAR,CACAc,QAAQ,CAACjB,eAAe,CAAC,CAAD,CAAhB,CAAR,CACA,GAAGmB,QAAQ,GAAK,EAAb,EAAmBC,KAAK,GAAK,EAAhC,CAAmC,CACjCH,QAAQ,CAACnB,gBAAgB,EAAjB,CAAR,CACD,CAFD,IAEO,CACLmB,QAAQ,CAACpB,aAAa,CAACsB,QAAD,CAAWC,KAAX,CAAd,CAAR,CACD,CACF,CA5BI,CAAP,CA8BD,CA/BD,CAiCA,cAAeZ,CAAAA,OAAO,CAAC8C,eAAD,CAAkBG,kBAAlB,CAAP,CAA6C3C,OAA7C,CAAf","sourcesContent":["import React, { useEffect,useContext} from 'react';\r\nimport Horizen from '../../baseUI/horizen-item';\r\nimport { categoryTypes, alphaTypes } from '../../api/config';\r\nimport { \r\n  NavContainer,\r\n  ListContainer,\r\n  List,\r\n  ListItem,\r\n} from \"./style\";\r\nimport { \r\n  getSingerList, \r\n  getHotSingerList, \r\n  changeEnterLoading, \r\n  changePageCount, \r\n  refreshMoreSingerList, \r\n  changePullUpLoading, \r\n  changePullDownLoading, \r\n  refreshMoreHotSingerList \r\n} from './store/actionCreators';\r\nimport  LazyLoad, {forceCheck} from 'react-lazyload';\r\nimport Scroll from './../../baseUI/scroll/index';\r\nimport {connect} from 'react-redux';\r\nimport Loading from '../../baseUI/loading';\r\nimport {renderRoutes} from 'react-router-config';\r\nimport { CHANGE_CATEGORY,CHANGE_ALPHA ,CategoryDataContext} from './data';\r\n\r\nfunction Singers(props) {\r\n  const {data,dispatch} = useContext(CategoryDataContext);\r\n  //拿到 category 和 alpha 的值\r\n  const {category,alpha} = data.toJS();\r\n\r\n  const { singerList, enterLoading, pullUpLoading, pullDownLoading, pageCount } = props;\r\n\r\n  const { getHotSingerDispatch, updateDispatch, pullDownRefreshDispatch, pullUpRefreshDispatch } = props;\r\n\r\n  // 歌手列表页的数据缓存\r\n  useEffect(() => {\r\n    if(!singerList.size){\r\n      getHotSingerDispatch();\r\n    }\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  let handleUpdateAlpha = (val) => {\r\n    dispatch({type:CHANGE_ALPHA,data:val})\r\n    updateDispatch(category, val);\r\n  };\r\n\r\n  let handleUpdateCatetory = (val) => {\r\n    dispatch({type:CHANGE_CATEGORY,data:val})\r\n    updateDispatch(val, alpha);\r\n  };\r\n\r\n  const handlePullUp = () => {\r\n    pullUpRefreshDispatch(category, alpha, category === '', pageCount);\r\n  };\r\n\r\n  const handlePullDown = () => {\r\n    pullDownRefreshDispatch(category, alpha);\r\n  };\r\n\r\n  const enterDetail = (id) => {\r\n    props.history.push(`/singers/${id}`)\r\n  }\r\n\r\n  const renderSingerList = () => {\r\n    const list = singerList ? singerList.toJS(): [];\r\n    console.log(props)\r\n    return (\r\n      <List>\r\n        {\r\n          list.map((item, index) => {\r\n            return (\r\n              <ListItem key={item.accountId+\"\"+index} onClick={() => enterDetail(item.id)}>\r\n                <div className=\"img_wrapper\">\r\n                  <LazyLoad placeholder={<img width=\"100%\" height=\"100%\" src={require('./singer.png')} alt=\"music\"/>}>\r\n                    <img src={`${item.picUrl}?param=300x300`} width=\"100%\" height=\"100%\" alt=\"music\"/>\r\n                  </LazyLoad>\r\n                </div>\r\n                <span className=\"name\">{item.name}</span>\r\n              </ListItem>\r\n            )\r\n          })\r\n        }\r\n      </List>\r\n    )\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <NavContainer>\r\n        <Horizen list={categoryTypes} title={\"分类(默认热门):\"} handleClick={(val) => handleUpdateCatetory(val)} oldVal={category}></Horizen>\r\n        <Horizen list={alphaTypes} title={\"首字母:\"} handleClick={val => handleUpdateAlpha(val)} oldVal={alpha}></Horizen>\r\n      </NavContainer> \r\n      <ListContainer>\r\n        <Scroll\r\n          pullUp={ handlePullUp }\r\n          pullDown = { handlePullDown }\r\n          pullUpLoading = { pullUpLoading }\r\n          pullDownLoading = { pullDownLoading }\r\n          onScroll={forceCheck}\r\n        >\r\n          { renderSingerList() }\r\n        </Scroll>\r\n        <Loading show={enterLoading}></Loading>\r\n      </ListContainer>\r\n      {renderRoutes(props.route.routes)}\r\n    </div>\r\n  )\r\n}\r\n\r\nconst mapStateToProps = (state) => ({\r\n  singerList: state.getIn(['singers', 'singerList']),\r\n  enterLoading: state.getIn(['singers', 'enterLoading']),\r\n  pullUpLoading: state.getIn(['singers', 'pullUpLoading']),\r\n  pullDownLoading: state.getIn(['singers', 'pullDownLoading']),\r\n  pageCount: state.getIn(['singers', 'pageCount'])\r\n});\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    getHotSingerDispatch() {\r\n      dispatch(getHotSingerList());\r\n    },\r\n    updateDispatch(category, alpha) {\r\n      dispatch(changePageCount(0));\r\n      dispatch(changeEnterLoading(true));\r\n      dispatch(getSingerList(category, alpha));\r\n    },\r\n    // 滑到最底部刷新部分的处理\r\n    pullUpRefreshDispatch(category, alpha, hot, count) {\r\n      dispatch(changePullUpLoading(true));\r\n      dispatch(changePageCount(count+1));\r\n      if(hot){\r\n        dispatch(refreshMoreHotSingerList());\r\n      } else {\r\n        dispatch(refreshMoreSingerList(category, alpha));\r\n      }\r\n    },\r\n    //顶部下拉刷新\r\n    pullDownRefreshDispatch(category, alpha) {\r\n      dispatch(changePullDownLoading(true));\r\n      dispatch(changePageCount(0));\r\n      if(category === '' && alpha === ''){\r\n        dispatch(getHotSingerList());\r\n      } else {\r\n        dispatch(getSingerList(category, alpha));\r\n      }\r\n    }\r\n  }\r\n};   \r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Singers);"]},"metadata":{},"sourceType":"module"}