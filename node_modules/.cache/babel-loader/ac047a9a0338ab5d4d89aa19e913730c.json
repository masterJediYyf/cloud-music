{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\86136\\\\Desktop\\\\\\u5B66\\u4E60\\u8FDB\\u5EA6\\\\new_html\\\\fullstack_yyf\\\\react\\\\cloud-music\\\\src\\\\application\\\\Album\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { Container, TopDesc, Menu, SongList, SongItem } from './style';\nimport { CSSTransition } from 'react-transition-group';\nimport Header from './../../baseUI/header/index';\nimport Scroll from '../../baseUI/scroll/index';\nimport { getCount, isEmptyObject } from '../../api/utils';\nimport { getName } from './../../api/utils';\nimport { HEADER_HEIGHT } from './../../api/config';\nimport style from \"../../assets/global-style\";\nimport { connect } from 'react-redux';\nimport { getAlbumList, changeEnterLoading } from './store/actionCreators';\nimport Loading from '../../baseUI/loading/index';\nimport MusicNote from '../../baseUI/music-note';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Album(props) {\n  _s();\n\n  const [showStatus, setShowStatus] = useState(true);\n  const [title, setTitle] = useState(\"歌单\");\n  const [isMarquee, setIsMarquee] = useState(false); //是否跑马灯\n\n  const headerEl = useRef();\n  const {\n    currentAlbum: currentAlbumImmutable,\n    enterLoading\n  } = props;\n  const {\n    getAlbumDataDispatch\n  } = props;\n  const id = props.match.params.id;\n  const musicNoteRef = useRef();\n\n  const musicAnimation = (x, y) => {\n    musicNoteRef.current.startAnimation({\n      x,\n      y\n    });\n  };\n\n  useEffect(() => {\n    getAlbumDataDispatch(id);\n  }, [getAlbumDataDispatch, id]);\n  let currentAlbum = currentAlbumImmutable.toJS();\n  const handleBack = useCallback(() => {\n    setShowStatus(false);\n  }, []);\n  const handleScroll = useCallback(pos => {\n    let minScrollY = -HEADER_HEIGHT;\n    let percent = Math.abs(pos.y / minScrollY);\n    let headerDom = headerEl.current; //滑过顶部的高度开始变化\n\n    if (pos.y < minScrollY) {\n      headerDom.style.backgroundColor = style[\"theme-color\"];\n      headerDom.style.opacity = Math.min(1, (percent - 1) / 2);\n      setTitle(currentAlbum.name);\n      setIsMarquee(true);\n    } else {\n      headerDom.style.backgroundColor = \"\";\n      headerDom.style.opacity = 1;\n      setTitle(\"歌单\");\n      setIsMarquee(false);\n    }\n  }, [currentAlbum]);\n\n  const renderTopDesc = () => {\n    return /*#__PURE__*/_jsxDEV(TopDesc, {\n      background: currentAlbum.coverImgUrl,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"background\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"filter\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"img_wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"decorate\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: currentAlbum.coverImgUrl,\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"play_count\",\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"iconfont play\",\n            children: \"\\uE885\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 71,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"count\",\n            children: getCount(currentAlbum.subscribedCount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 72,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"desc_wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"title\",\n          children: currentAlbum.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"person\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"avatar\",\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: currentAlbum.creator.avatarUrl,\n              alt: \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 79,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"name\",\n            children: currentAlbum.creator.nickname\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderMenu = () => {\n    return /*#__PURE__*/_jsxDEV(Menu, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE6AD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 11\n        }, this), \"\\u8BC4\\u8BBA\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE86F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this), \"\\u70B9\\u8D5E\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE62D\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, this), \"\\u6536\\u85CF\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont\",\n          children: \"\\uE606\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 11\n        }, this), \"\\u66F4\\u591A\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this);\n  };\n\n  const renderSongList = () => {\n    return /*#__PURE__*/_jsxDEV(SongList, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"first_line\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"play_all\",\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"iconfont\",\n            children: \"\\uE6E3\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"\\u64AD\\u653E\\u5168\\u90E8 \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"sum\",\n              children: [\"(\\u5171\", currentAlbum.tracks.length, \"\\u9996)\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 117,\n              columnNumber: 24\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"add_list\",\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"iconfont\",\n            children: \"\\uE62D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"\\u6536\\u85CF(\", getCount(currentAlbum.subscribedCount), \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SongItem, {\n        children: currentAlbum.tracks.map((item, index) => {\n          return /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"index\",\n              children: index + 1\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 131,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [getName(item.ar), \" - \", item.al.name]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 132,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 130,\n              columnNumber: 19\n            }, this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 17\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(CSSTransition, {\n    in: showStatus,\n    timeout: 300,\n    classNames: \"fly\",\n    appear: true,\n    unmountOnExit: true,\n    onExited: props.history.goBack,\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        ref: headerEl,\n        title: title,\n        handleClick: handleBack,\n        isMarquee: isMarquee\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 9\n      }, this), !isEmptyObject(currentAlbum) ? /*#__PURE__*/_jsxDEV(Scroll, {\n        bounceTop: false,\n        onScroll: handleScroll,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [renderTopDesc(), renderMenu(), renderSongList()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 13\n      }, this) : null, enterLoading ? /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 26\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 146,\n    columnNumber: 5\n  }, this);\n} // 映射Redux全局的state到组件的props上\n\n\n_s(Album, \"4ypYFvwXNCD9ky5WNQngj5MpTYE=\");\n\n_c = Album;\n\nconst mapStateToProps = state => ({\n  currentAlbum: state.getIn(['album', 'currentAlbum']),\n  enterLoading: state.getIn(['album', 'enterLoading'])\n}); // 映射dispatch到props上\n\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    getAlbumDataDispatch(id) {\n      dispatch(changeEnterLoading(true));\n      dispatch(getAlbumList(id));\n    }\n\n  };\n}; // 将ui组件包装成容器组件\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)( /*#__PURE__*/React.memo(Album));\n\nvar _c;\n\n$RefreshReg$(_c, \"Album\");","map":{"version":3,"sources":["C:/Users/86136/Desktop/学习进度/new_html/fullstack_yyf/react/cloud-music/src/application/Album/index.js"],"names":["React","useState","useCallback","useRef","useEffect","Container","TopDesc","Menu","SongList","SongItem","CSSTransition","Header","Scroll","getCount","isEmptyObject","getName","HEADER_HEIGHT","style","connect","getAlbumList","changeEnterLoading","Loading","MusicNote","Album","props","showStatus","setShowStatus","title","setTitle","isMarquee","setIsMarquee","headerEl","currentAlbum","currentAlbumImmutable","enterLoading","getAlbumDataDispatch","id","match","params","musicNoteRef","musicAnimation","x","y","current","startAnimation","toJS","handleBack","handleScroll","pos","minScrollY","percent","Math","abs","headerDom","backgroundColor","opacity","min","name","renderTopDesc","coverImgUrl","subscribedCount","creator","avatarUrl","nickname","renderMenu","renderSongList","tracks","length","map","item","index","ar","al","history","goBack","mapStateToProps","state","getIn","mapDispatchToProps","dispatch","memo"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { Container, TopDesc, Menu, SongList, SongItem } from './style';\r\nimport { CSSTransition } from 'react-transition-group';\r\nimport Header from './../../baseUI/header/index';\r\nimport Scroll from '../../baseUI/scroll/index';\r\nimport { getCount, isEmptyObject } from '../../api/utils';\r\nimport { getName } from './../../api/utils';\r\nimport { HEADER_HEIGHT } from './../../api/config';\r\nimport style from \"../../assets/global-style\";\r\nimport { connect } from 'react-redux';\r\nimport { getAlbumList, changeEnterLoading } from './store/actionCreators';\r\nimport Loading from '../../baseUI/loading/index';\r\nimport MusicNote from '../../baseUI/music-note';\r\n\r\nfunction Album(props) {\r\n  const [showStatus, setShowStatus] = useState(true);\r\n  const [title, setTitle] = useState(\"歌单\");\r\n  const [isMarquee, setIsMarquee] = useState(false);//是否跑马灯\r\n\r\n  const headerEl = useRef();\r\n\r\n  const { currentAlbum: currentAlbumImmutable, enterLoading } = props;\r\n  const { getAlbumDataDispatch } = props;\r\n\r\n  const id = props.match.params.id;\r\n\r\n  const musicNoteRef = useRef ();\r\n\r\n  const musicAnimation = (x, y) => {\r\n    musicNoteRef.current.startAnimation ({ x, y });\r\n  };\r\n\r\n  useEffect(() => {\r\n    getAlbumDataDispatch(id);\r\n  }, [getAlbumDataDispatch, id]);\r\n\r\n  let currentAlbum = currentAlbumImmutable.toJS();\r\n\r\n  const handleBack = useCallback(() => {\r\n    setShowStatus(false);\r\n  }, []);\r\n\r\n  const handleScroll = useCallback((pos) => {\r\n    let minScrollY = -HEADER_HEIGHT;\r\n    let percent = Math.abs(pos.y / minScrollY);\r\n    let headerDom = headerEl.current;\r\n    //滑过顶部的高度开始变化\r\n    if (pos.y < minScrollY) {\r\n      headerDom.style.backgroundColor = style[\"theme-color\"];\r\n      headerDom.style.opacity = Math.min(1, (percent - 1) / 2);\r\n      setTitle(currentAlbum.name);\r\n      setIsMarquee(true);\r\n    } else {\r\n      headerDom.style.backgroundColor = \"\";\r\n      headerDom.style.opacity = 1;\r\n      setTitle(\"歌单\");\r\n      setIsMarquee(false);\r\n    }\r\n  }, [currentAlbum]);\r\n\r\n  const renderTopDesc = () => {\r\n    return (\r\n      <TopDesc background={currentAlbum.coverImgUrl}>\r\n        <div className=\"background\">\r\n          <div className=\"filter\"></div>\r\n        </div>\r\n        <div className=\"img_wrapper\">\r\n          <div className=\"decorate\"></div>\r\n          <img src={currentAlbum.coverImgUrl} alt=\"\" />\r\n          <div className=\"play_count\">\r\n            <i className=\"iconfont play\">&#xe885;</i>\r\n            <span className=\"count\">{getCount(currentAlbum.subscribedCount)}</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"desc_wrapper\">\r\n          <div className=\"title\">{currentAlbum.name}</div>\r\n          <div className=\"person\">\r\n            <div className=\"avatar\">\r\n              <img src={currentAlbum.creator.avatarUrl} alt=\"\" />\r\n            </div>\r\n            <div className=\"name\">{currentAlbum.creator.nickname}</div>\r\n          </div>\r\n        </div>\r\n      </TopDesc>\r\n    )\r\n  }\r\n\r\n  const renderMenu = () => {\r\n    return (\r\n      <Menu>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe6ad;</i>\r\n          评论\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe86f;</i>\r\n          点赞\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe62d;</i>\r\n          收藏\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe606;</i>\r\n          更多\r\n        </div>\r\n      </Menu>\r\n    )\r\n  };\r\n\r\n  const renderSongList = () => {\r\n    return (\r\n      <SongList>\r\n        <div className=\"first_line\">\r\n          <div className=\"play_all\">\r\n            <i className=\"iconfont\">&#xe6e3;</i>\r\n            <span>播放全部 <span className=\"sum\">(共{currentAlbum.tracks.length}首)</span></span>\r\n          </div>\r\n          <div className=\"add_list\">\r\n            <i className=\"iconfont\">&#xe62d;</i>\r\n            <span>收藏({getCount(currentAlbum.subscribedCount)})</span>\r\n          </div>\r\n        </div>\r\n        <SongItem>\r\n          {\r\n            currentAlbum.tracks.map((item, index) => {\r\n              return (\r\n                <li key={index}>\r\n                  <span className=\"index\">{index + 1}</span>\r\n                  <div className=\"info\">\r\n                    <span>{item.name}</span>\r\n                    <span>\r\n                      {getName(item.ar)} - {item.al.name}\r\n                    </span>\r\n                  </div>\r\n                </li>\r\n              )\r\n            })\r\n          }\r\n        </SongItem>\r\n      </SongList>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <CSSTransition\r\n      in={showStatus}\r\n      timeout={300}\r\n      classNames=\"fly\"\r\n      appear={true}\r\n      unmountOnExit\r\n      onExited={props.history.goBack}\r\n    >\r\n      <Container>\r\n        <Header ref={headerEl} title={title} handleClick={handleBack} isMarquee={isMarquee}></Header>\r\n        {!isEmptyObject(currentAlbum) ?\r\n          (\r\n            <Scroll\r\n              bounceTop={false}\r\n              onScroll={handleScroll}\r\n            >\r\n              <div>\r\n                { renderTopDesc() }\r\n                { renderMenu() }\r\n                { renderSongList() }\r\n              </div>\r\n            </Scroll>\r\n          )\r\n          : null\r\n        }\r\n        { enterLoading ? <Loading></Loading> : null}\r\n      </Container>\r\n    </CSSTransition>\r\n  )\r\n}\r\n\r\n// 映射Redux全局的state到组件的props上\r\nconst mapStateToProps = (state) => ({\r\n  currentAlbum: state.getIn(['album', 'currentAlbum']),\r\n  enterLoading: state.getIn(['album', 'enterLoading']),\r\n});\r\n// 映射dispatch到props上\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    getAlbumDataDispatch(id) {\r\n      dispatch(changeEnterLoading(true));\r\n      dispatch(getAlbumList(id));\r\n    },\r\n  }\r\n};\r\n\r\n// 将ui组件包装成容器组件\r\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Album));"]},"metadata":{},"sourceType":"module"}